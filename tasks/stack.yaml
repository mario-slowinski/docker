---
- name: "Manage docker stacks"
  community.docker.docker_stack:
    name: "{{ item['name'] | default(omit) }}"
    compose: "{{ item['compose'] | default(omit) }}"
    state: "{{ item['state'] | default(omit) }}"
  loop: "{{ docker_stacks | selectattr('name',(docker_stack is defined)|ternary('in','ne'),docker_stack|default([])) }}"
  loop_control:
    label: "{{ item['name'] }}"
  run_once: true
